# 数据库配置修改说明

## 📋 需要修改的配置文件

### 1. **主配置文件（必须修改）**
   - **文件路径**: `server/db_config.php`
   - **需要修改的字段**:
     ```php
     return [
         'host' => 'localhost',        // 数据库主机地址
         'port' => 3306,              // 数据库端口
         'database' => 'zhanli',       // 数据库名称
         'username' => 'root',         // 数据库用户名
         'password' => '',             // 数据库密码
         'charset' => 'utf8mb4',
     ];
     ```

### 2. **数据库导出脚本**
   - **文件路径**: `export_db.sh`
   - **需要修改的变量**:
     ```bash
     DB_NAME="zhanli"    # 数据库名称
     DB_USER="root"      # 数据库用户名
     ```

### 3. **数据库导入脚本**
   - **文件路径**: `import_db.sh`
   - **需要修改的变量**:
     ```bash
     DB_NAME="zhanli"    # 数据库名称
     ```

## 📝 使用此配置文件的所有文件

以下文件通过 `require_once '../server/db_config.php'` 或 `require_once 'db_config.php'` 引入配置，**无需单独修改**，只需修改主配置文件即可：

### 管理后台文件
- `admin/index.php`
- `admin/login.php`
- `admin/profile.php`
- `admin/config.php`
- `admin/config_backup.php`
- `admin/config_api.php`
- `admin/website.php`
- `admin/miniprogram.php`
- `admin/products.php`
- `admin/cardkeys.php`
- `admin/tutorials.php`
- `admin/faqs.php`
- `admin/orders.php`
- `admin/users.php`

### 服务器端文件
- `server/config_db.php`
- `server/init_configs.php`
- `server/init_website_configs.php`
- `server/pay_handler.php`
- `server/pay_notify.php`
- `server/shop_handler.php`
- `server/login_api.php`

## 🔧 修改步骤

### 方法一：直接修改主配置文件（推荐）

1. 打开 `server/db_config.php`
2. 修改以下配置：
   ```php
   return [
       'host' => '你的数据库地址',      // 例如: 'localhost' 或 '127.0.0.1' 或 '192.168.1.100'
       'port' => 3306,                  // MySQL默认端口，如不是请修改
       'database' => '你的数据库名',     // 例如: 'zhanli' 或 'poxiao_qystudio'
       'username' => '你的数据库用户名',  // 例如: 'root' 或 'zhanli_user'
       'password' => '你的数据库密码',    // 填写实际密码
       'charset' => 'utf8mb4',
   ];
   ```

3. 如果使用导出/导入脚本，还需要修改：
   - `export_db.sh` 中的 `DB_NAME` 和 `DB_USER`
   - `import_db.sh` 中的 `DB_NAME`

### 方法二：使用环境变量（高级）

可以在 `server/db_config.php` 中读取环境变量：
```php
return [
    'host' => getenv('DB_HOST') ?: 'localhost',
    'port' => (int)(getenv('DB_PORT') ?: 3306),
    'database' => getenv('DB_NAME') ?: 'zhanli',
    'username' => getenv('DB_USER') ?: 'root',
    'password' => getenv('DB_PASSWORD') ?: '',
    'charset' => 'utf8mb4',
];
```

## ⚠️ 注意事项

1. **安全性**: 
   - 生产环境不要在代码中硬编码密码
   - 建议使用环境变量或配置文件（不在版本控制中）

2. **数据库权限**:
   - 确保数据库用户有足够的权限（SELECT, INSERT, UPDATE, DELETE, CREATE, DROP等）

3. **连接测试**:
   - 修改配置后，建议先测试数据库连接是否正常

4. **备份**:
   - 修改配置前建议备份原配置文件

## 🔍 验证配置是否生效

修改配置后，可以：
1. 访问管理后台登录页面，检查是否能正常连接数据库
2. 查看服务器错误日志，确认没有数据库连接错误
3. 运行 `export_db.sh` 脚本，测试是否能正常导出数据库

