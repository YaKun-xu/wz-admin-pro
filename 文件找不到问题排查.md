# æ–‡ä»¶æ‰¾ä¸åˆ°é—®é¢˜æ’æŸ¥æŒ‡å—

## ğŸ” å¸¸è§é—®é¢˜

### 1. **è®¿é—®é¡µé¢å‡ºç° 404 é”™è¯¯**

#### æ£€æŸ¥é¡¹ç›®ç›®å½•ç»“æ„
ç¡®ä¿æ–‡ä»¶è·¯å¾„æ­£ç¡®ï¼š
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ index.php          # é¦–é¡µ
â”œâ”€â”€ admin/
â”‚   â”œâ”€â”€ login.php     # ç™»å½•é¡µé¢
â”‚   â””â”€â”€ index.php     # ç®¡ç†åå°
â””â”€â”€ server/
    â””â”€â”€ db_config.php # æ•°æ®åº“é…ç½®
```

#### è®¿é—®åœ°å€
- **é¦–é¡µ**: `http://ä½ çš„åŸŸå/index.php`
- **ç™»å½•é¡µ**: `http://ä½ çš„åŸŸå/admin/login.php`
- **ç®¡ç†åå°**: `http://ä½ çš„åŸŸå/admin/index.php`

### 2. **æ•°æ®åº“é…ç½®æ–‡ä»¶æ‰¾ä¸åˆ°**

#### é”™è¯¯ä¿¡æ¯
```
Warning: require_once(../server/db_config.php): failed to open stream: No such file or directory
```

#### è§£å†³æ–¹æ¡ˆ
æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼š
- ä» `admin/` ç›®å½•è®¿é—®ï¼šä½¿ç”¨ `../server/db_config.php` âœ…
- ä»æ ¹ç›®å½•è®¿é—®ï¼šä½¿ç”¨ `server/db_config.php` âœ…

#### æ£€æŸ¥æ–¹æ³•
åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ è°ƒè¯•ä»£ç ï¼š
```php
// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if (!file_exists('../server/db_config.php')) {
    die('æ•°æ®åº“é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: ' . realpath('../server/db_config.php'));
}
```

### 3. **é™æ€èµ„æºæ–‡ä»¶æ‰¾ä¸åˆ°**

#### æ£€æŸ¥ assets ç›®å½•
```
assets/
â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ admin.css
â”‚   â””â”€â”€ table-enhanced.css
â”œâ”€â”€ js/
â”‚   â””â”€â”€ admin.js
â””â”€â”€ image/
```

#### è·¯å¾„é—®é¢˜
- å¦‚æœä» `admin/` è®¿é—®ï¼š`../assets/css/admin.css` âœ…
- å¦‚æœä»æ ¹ç›®å½•è®¿é—®ï¼š`assets/css/admin.css` âœ…

### 4. **æœåŠ¡å™¨é…ç½®é—®é¢˜**

#### Apache é…ç½®
ç¡®ä¿ `.htaccess` æ–‡ä»¶å­˜åœ¨ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š
```apache
# .htaccess
RewriteEngine On
RewriteBase /

# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°è¯•é‡å®šå‘
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]
```

#### Nginx é…ç½®ç¤ºä¾‹
```nginx
location / {
    try_files $uri $uri/ /index.php?$query_string;
}
```

### 5. **PHP æ–‡ä»¶æƒé™é—®é¢˜**

#### æ£€æŸ¥æ–‡ä»¶æƒé™
```bash
# ç¡®ä¿PHPæ–‡ä»¶å¯è¯»
chmod 644 *.php
chmod 644 admin/*.php
chmod 644 server/*.php

# ç¡®ä¿ç›®å½•å¯æ‰§è¡Œ
chmod 755 admin/
chmod 755 server/
```

### 6. **ç›¸å¯¹è·¯å¾„é—®é¢˜**

#### å¸¸è§è·¯å¾„é”™è¯¯
```php
// âŒ é”™è¯¯ï¼šä»adminç›®å½•è®¿é—®æ—¶
require_once 'server/db_config.php';

// âœ… æ­£ç¡®ï¼šä»adminç›®å½•è®¿é—®æ—¶
require_once '../server/db_config.php';

// âœ… æˆ–è€…ä½¿ç”¨ç»å¯¹è·¯å¾„
require_once __DIR__ . '/../server/db_config.php';
```

### 7. **ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼ˆæ¨èï¼‰**

ä¿®æ”¹æ‰€æœ‰æ–‡ä»¶ï¼Œä½¿ç”¨ `__DIR__` è·å–ç»å¯¹è·¯å¾„ï¼š
```php
// æ¨èå†™æ³•
require_once __DIR__ . '/../server/db_config.php';
```

### 8. **æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨**

#### åˆ›å»ºæµ‹è¯•æ–‡ä»¶
åˆ›å»º `test_paths.php` æ£€æŸ¥è·¯å¾„ï¼š
```php
<?php
echo "å½“å‰æ–‡ä»¶: " . __FILE__ . "\n";
echo "å½“å‰ç›®å½•: " . __DIR__ . "\n";
echo "\n";

$paths = [
    '../server/db_config.php',
    __DIR__ . '/../server/db_config.php',
    'server/db_config.php',
];

foreach ($paths as $path) {
    $realpath = realpath($path);
    echo "è·¯å¾„: $path\n";
    echo "å®é™…è·¯å¾„: " . ($realpath ?: 'ä¸å­˜åœ¨') . "\n";
    echo "å­˜åœ¨: " . (file_exists($path) ? 'æ˜¯' : 'å¦') . "\n\n";
}
?>
```

## ğŸ”§ å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼ˆæœ€ç®€å•ï¼‰

å°†æ‰€æœ‰ `require_once` æ”¹ä¸ºä½¿ç”¨ `__DIR__`ï¼š

```php
// ä¿®æ”¹å‰
require_once '../server/db_config.php';

// ä¿®æ”¹å
require_once __DIR__ . '/../server/db_config.php';
```

### æ–¹æ¡ˆ2: æ£€æŸ¥å½“å‰å·¥ä½œç›®å½•

åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š
```php
// æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•
echo "å½“å‰ç›®å½•: " . getcwd() . "\n";
echo "è„šæœ¬ç›®å½•: " . __DIR__ . "\n";
```

### æ–¹æ¡ˆ3: æ·»åŠ é”™è¯¯å¤„ç†

```php
$configFile = __DIR__ . '/../server/db_config.php';
if (!file_exists($configFile)) {
    die("é”™è¯¯: æ‰¾ä¸åˆ°æ•°æ®åº“é…ç½®æ–‡ä»¶: $configFile");
}
require_once $configFile;
```

## ğŸ“‹ æ£€æŸ¥æ¸…å•

- [ ] ç¡®è®¤æ–‡ä»¶æ˜¯å¦å­˜åœ¨äºæœåŠ¡å™¨ä¸Š
- [ ] æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼ˆç›¸å¯¹è·¯å¾„ vs ç»å¯¹è·¯å¾„ï¼‰
- [ ] æ£€æŸ¥æ–‡ä»¶æƒé™ï¼ˆ644 æˆ– 755ï¼‰
- [ ] æ£€æŸ¥ Web æœåŠ¡å™¨é…ç½®ï¼ˆApache/Nginxï¼‰
- [ ] æŸ¥çœ‹ PHP é”™è¯¯æ—¥å¿—
- [ ] æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆç¡®ä¿æ–‡ä»¶ä¸ä¸ºç©ºï¼‰
- [ ] ç¡®è®¤æ–‡ä»¶ç¼–ç ï¼ˆUTF-8 without BOMï¼‰

## ğŸ› è°ƒè¯•æ­¥éª¤

1. **æŸ¥çœ‹ PHP é”™è¯¯æ—¥å¿—**
   ```bash
   tail -f /var/log/php_errors.log
   # æˆ–
   tail -f /var/log/apache2/error.log
   ```

2. **å¯ç”¨é”™è¯¯æ˜¾ç¤º**
   åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š
   ```php
   error_reporting(E_ALL);
   ini_set('display_errors', 1);
   ```

3. **æ£€æŸ¥æ–‡ä»¶è·¯å¾„**
   ```php
   var_dump([
       '__FILE__' => __FILE__,
       '__DIR__' => __DIR__,
       'getcwd()' => getcwd(),
       'file_exists' => file_exists('../server/db_config.php')
   ]);
   ```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **ç»Ÿä¸€ä½¿ç”¨ç»å¯¹è·¯å¾„**
   ```php
   require_once __DIR__ . '/../server/db_config.php';
   ```

2. **æ·»åŠ æ–‡ä»¶å­˜åœ¨æ£€æŸ¥**
   ```php
   $file = __DIR__ . '/../server/db_config.php';
   if (!file_exists($file)) {
       throw new Exception("é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: $file");
   }
   require_once $file;
   ```

3. **ä½¿ç”¨å¸¸é‡å®šä¹‰æ ¹ç›®å½•**
   ```php
   // åœ¨å…¥å£æ–‡ä»¶å®šä¹‰
   define('ROOT_PATH', __DIR__);
   
   // åœ¨å…¶ä»–æ–‡ä»¶ä¸­ä½¿ç”¨
   require_once ROOT_PATH . '/server/db_config.php';
   ```

## ğŸ“ éœ€è¦æ›´å¤šå¸®åŠ©ï¼Ÿ

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. å®Œæ•´çš„é”™è¯¯ä¿¡æ¯
2. è®¿é—®çš„ URL
3. æœåŠ¡å™¨ç±»å‹ï¼ˆApache/Nginxï¼‰
4. PHP ç‰ˆæœ¬
5. é”™è¯¯å‘ç”Ÿçš„å…·ä½“æ–‡ä»¶

