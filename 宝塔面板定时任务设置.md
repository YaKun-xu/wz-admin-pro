# 🎛️ 宝塔面板定时清理订单设置指南

## 📍 宝塔面板位置

您的PHP清理脚本应该放在宝塔站点目录下：
```
/www/wwwroot/your_domain.com/server/cleanup_expired_orders.php
```

---

## 🚀 宝塔面板设置步骤

### 1. **登录宝塔面板**
- 访问您的宝塔面板（通常是 `http://您的IP:8888`）
- 输入用户名和密码登录

### 2. **进入计划任务**
- 在左侧菜单点击 **"计划任务"**
- 或者在首页找到 **"计划任务"** 模块

### 3. **添加计划任务**
点击 **"添加任务"** 按钮，填写以下信息：

#### 基本设置
- **任务类型**: 选择 `Shell脚本`
- **任务名称**: `清理过期订单` (可自定义)
- **执行周期**: 选择 `N分钟` 

#### 时间设置
- **时间间隔**: 输入 `10` (表示每10分钟执行一次)
- 或者选择其他间隔：
  - `5` = 每5分钟
  - `15` = 每15分钟  
  - `30` = 每30分钟

#### 脚本内容
在 **"脚本内容"** 框中输入：
```bash
#!/bin/bash
cd /www/wwwroot/your_domain.com/server
/www/server/php/74/bin/php cleanup_expired_orders.php
```

> **重要**: 请将路径替换为您的实际路径：
> - `your_domain.com` 改为您的域名
> - `php/74` 改为您使用的PHP版本（如php/80、php/81等）

### 4. **保存任务**
- 点击 **"保存"** 按钮
- 确认任务已添加到任务列表中

---

## 🔍 如何确认PHP路径

### 方法一：宝塔面板查看
1. 进入 **"软件商店"**
2. 找到 **"PHP"** 
3. 查看已安装的PHP版本
4. 常见路径：
   - PHP 7.4: `/www/server/php/74/bin/php`
   - PHP 8.0: `/www/server/php/80/bin/php`
   - PHP 8.1: `/www/server/php/81/bin/php`

### 方法二：SSH命令查看
```bash
# 查找PHP路径
which php

# 或者查看宝塔PHP路径
ls -la /www/server/php/*/bin/php
```

---

## 📁 完整示例

假设您的配置如下：
- **域名**: `api.wzgzq.cn`
- **PHP版本**: `8.0`
- **清理间隔**: 每10分钟

### 脚本内容
```bash
#!/bin/bash
cd /www/wwwroot/api.wzgzq.cn/server
/www/server/php/80/bin/php cleanup_expired_orders.php >> /www/wwwroot/api.wzgzq.cn/server/cron.log 2>&1
```

### 任务设置
- **任务类型**: Shell脚本
- **任务名称**: 清理过期订单
- **执行周期**: N分钟 → 10

---

## 📊 宝塔面板任务管理

### 查看任务状态
1. 在 **"计划任务"** 页面可以看到：
   - ✅ 任务是否启用
   - 📅 下次执行时间
   - 📝 执行日志

### 手动执行测试
1. 找到您创建的任务
2. 点击 **"执行"** 按钮进行测试
3. 查看执行结果

### 查看执行日志
1. 点击任务后面的 **"日志"** 按钮
2. 查看任务执行历史和结果

---

## 📝 常见问题解决

### 1. **任务不执行**
- 检查PHP路径是否正确
- 确认脚本文件路径正确
- 查看宝塔面板系统日志

### 2. **权限问题**
```bash
# 设置脚本执行权限
chmod +x /www/wwwroot/your_domain.com/server/cleanup_expired_orders.php

# 检查目录权限
ls -la /www/wwwroot/your_domain.com/server/
```

### 3. **PHP版本问题**
- 确保使用正确的PHP版本路径
- 可以在宝塔面板软件商店查看已安装的PHP版本

### 4. **日志文件权限**
```bash
# 创建日志文件并设置权限
touch /www/wwwroot/your_domain.com/server/cleanup.log
chmod 666 /www/wwwroot/your_domain.com/server/cleanup.log
```
---

## 📊 监控建议

### 宝塔面板监控
1. 定期检查计划任务执行状态
2. 查看任务执行日志
3. 监控服务器资源使用情况

### 自定义监控
- 设置日志文件大小监控
- 配置数据库订单数量监控
- 设置异常情况邮件报警

---

## 💡 最佳实践

1. **先测试再部署**: 使用1分钟间隔测试功能正常
2. **合理设置间隔**: 生产环境建议10-30分钟
3. **监控日志大小**: 定期清理过大的日志文件
4. **备份重要数据**: 定期备份数据库
5. **权限最小化**: 只给脚本必要的数据库权限

---

**现在您就可以在宝塔面板中轻松管理订单清理任务了！** 🎉 